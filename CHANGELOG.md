# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.3.0] - 2026-02-21

### Added

- **GitHub Actions CI** (`.github/workflows/ci.yml`): lint with ruff + test with pytest on Python 3.10, 3.11, 3.12
- **Terminal-styled documentation**: all code blocks in `docs.html` (25 blocks) and `tutorial.html` (16 blocks) converted to styled terminal components with bash-style syntax coloring

### Changed

- **`--ontology` is now required** on `build-kg-parse` and `build-kg-parse-batch` — no more regulatory fallback
- **`build_prompt()` requires an ontology** — raises `ValueError` when none is provided
- **Default graph name**: `AGE_GRAPH_NAME` default changed from `reg_ca` to `knowledge_graph`
- `parse_generic()` renamed to `parse_fragment()`
- `load_to_graph_generic()` renamed to `load_to_graph()` (both sync and batch)
- `setup_graph.py` skips label creation when no ontology is provided (so `make setup` still works)
- Updated all documentation and examples to use `knowledge_graph` instead of `reg_ca`

### Removed

- **Regulatory code path fully removed** from core pipeline (-456 net lines):
  - `ParsedProvision` dataclass
  - `parse_with_llm()` — regulatory LLM parsing
  - `load_to_graph()` — Provision/Requirement/Constraint Cypher queries (sync and batch)
  - `_build_regulatory_prompt()` — legacy prompt builder
  - `RegulatoryParser` backward-compatibility alias
  - `ProvisionIDExtractor` import from core pipeline
  - Hardcoded `RegulatorySource`/`Provision`/`Requirement`/`Constraint` vertex labels

## [0.2.0] - 2026-02-20

### Added

- **Generic knowledge graph builder**: build-kg now supports any topic, not just regulatory domains
- **Automatic ontology generation**: coding agent auto-generates graph ontology (node types, edge types, properties) for any topic
- **Agent skill files**: `.claude/skills/build-kg/SKILL.md` (Claude Code) and `AGENTS.md` (OpenAI Codex)
- **LLM provider abstraction** (`llm.py`): unified interface for Anthropic and OpenAI APIs
- **`LLM_PROVIDER`** env var (default: `anthropic`) to select between providers
- **`ANTHROPIC_API_KEY`** and **`ANTHROPIC_MODEL`** environment variables
- **`OntologyConfig`**, **`NodeDef`**, **`EdgeDef`** Pydantic models in `domain.py`
- **`--ontology` flag** on `build-kg-parse`, `build-kg-parse-batch`, and `build-kg-setup`
- **`metadata` JSONB column** on `source_document` and `source_fragment` tables
- **Generic JSON format**: `{entities: [...], relationships: [...]}` for ontology-driven LLM output
- **`load_ontology()`** function for loading standalone YAML ontology files
- **Domain profile system**: YAML-based profiles with inheritance via `extends` field
- **`DOMAIN`** env var and `--domain` CLI flag for profile selection
- **`build-kg-domains`** command to list available profiles
- Shared `build_prompt()` function eliminates prompt duplication between `parse.py` and `parse_batch.py`

### Changed

- **Default LLM provider is now Anthropic** (Claude Haiku 3.5) — was OpenAI GPT-4o-mini
- **`RegulatoryParser` renamed to `KGParser`** (backward-compatible alias kept)
- `default.yaml` is now a truly generic profile with empty parsing config (ontology auto-generated by skill)
- `source_document` and `source_fragment`: `jurisdiction`, `authority`, `doc_type` columns are now nullable TEXT (were required enums)
- `build_prompt()` routes between ontology-driven and legacy prompt templates
- Documentation consolidated from 13 HTML pages to 3 (`index.html`, `docs.html`, `tutorial.html`)
- All documentation repositioned as generic knowledge graph builder (removed regulatory-specific examples)
- Skill positioned for multi-agent support (Claude Code, OpenAI Codex, and compatible platforms)

### Fixed

- Profile inheritance with empty default lists no longer breaks profile loading

## [0.1.0] - 2026-02-18

### Added

- Initial release of build-kg
- Web crawler (`build-kg-crawl`) using Crawl4AI for regulatory websites
- Document chunker (`build-kg-chunk`) using Unstructured library
- Database loader (`build-kg-load`) for PostgreSQL with manifest-based metadata
- Regulatory parser (`build-kg-parse`) using OpenAI GPT-4o-mini
- Batch parser (`build-kg-parse-batch`) using OpenAI Batch API (50% cheaper)
- Apache AGE graph setup (`build-kg-setup`) for knowledge graph creation
- Setup verification (`build-kg-verify`) for database, AGE, and API checks
- Provision ID extraction with regex patterns for CA, US, and generic formats
- Docker Compose setup for PostgreSQL + Apache AGE
- Claude Code `/build-kg` skill with 5-round comprehensive source discovery
- Support for 20 jurisdictions (CA, US, EU, UK, AU, NZ, JP, SG, MY, TH, KR, CN, IN, AE, SA, BR, MX, ZA, and more)
- Documentation: architecture guide, quickstart tutorial, Singapore F&B tutorial
- CLI reference docs for all commands
- Example manifests for Canada and Singapore
