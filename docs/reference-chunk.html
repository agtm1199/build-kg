<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLI Reference: Chunker - build-kg</title>
  <style>
    :root { --bg: #0d1117; --surface: #161b22; --border: #30363d; --text: #c9d1d9; --text-muted: #8b949e; --heading: #f0f6fc; --link: #58a6ff; --accent: #1f6feb; --green: #3fb950; --orange: #d29922; --red: #f85149; --purple: #bc8cff; --code-bg: #0d1117; --inline-code-bg: #1c2128; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', 'Cascadia Code', 'Consolas', 'Liberation Mono', monospace; background: var(--bg); color: var(--text); line-height: 1.6; font-size: 16px; }
    .container { max-width: 960px; margin: 0 auto; padding: 2rem 1.5rem; }
    .hero { text-align: center; padding: 3rem 0; border-bottom: 1px solid var(--border); margin-bottom: 2rem; }
    .hero h1 { font-size: 2.5rem; color: var(--heading); margin-bottom: 0.5rem; letter-spacing: -0.02em; }
    .hero .tagline { font-size: 1.2rem; color: var(--text-muted); margin-bottom: 1.5rem; }
    .hero .badges { display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; }
    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 2rem; font-size: 0.8rem; font-weight: 600; border: 1px solid var(--border); color: var(--text-muted); }
    .badge.green { border-color: var(--green); color: var(--green); }
    .badge.blue { border-color: var(--link); color: var(--link); }
    .badge.purple { border-color: var(--purple); color: var(--purple); }
    section { margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border); }
    section:last-child { border-bottom: none; }
    h2 { font-size: 1.8rem; color: var(--heading); margin-bottom: 1rem; padding-top: 1rem; }
    h3 { font-size: 1.3rem; color: var(--heading); margin: 1.5rem 0 0.75rem; }
    p { margin-bottom: 1rem; }
    ul, ol { margin-bottom: 1rem; padding-left: 1.5rem; }
    li { margin-bottom: 0.25rem; }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }
    pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px; padding: 1rem 1.25rem; overflow-x: auto; margin: 1rem 0; font-size: 0.875rem; line-height: 1.5; }
    code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 0.875em; }
    :not(pre) > code { background: var(--inline-code-bg); padding: 0.15em 0.4em; border-radius: 3px; font-size: 0.85em; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.9rem; }
    th, td { text-align: left; padding: 0.6rem 0.8rem; border: 1px solid var(--border); }
    th { background: var(--surface); color: var(--heading); font-weight: 600; }
    tr:nth-child(even) { background: rgba(22, 27, 34, 0.5); }
    footer { text-align: center; padding: 2rem 0; color: var(--text-muted); font-size: 0.85rem; }
    @media (max-width: 700px) { .hero h1 { font-size: 2rem; } }
  </style>
</head>
<body>

<nav style="position:sticky;top:0;z-index:100;background:var(--surface);border-bottom:1px solid var(--border);padding:0.75rem 1.5rem;display:flex;align-items:center;gap:1.5rem;font-size:0.9rem;backdrop-filter:blur(8px);">
  <a href="index.html" style="color:var(--heading);font-weight:700;text-decoration:none;">build-<span style="color:var(--link)">kg</span></a>
  <a href="documentation.html">Docs</a>
  <a href="guide.html">Guide</a>
  <a href="reference-chunk.html" style="color:var(--heading);">Chunker</a>
  <a href="https://github.com/mergen-ai/build-kg" style="margin-left:auto;">GitHub</a>
</nav>

  <div class="container">

    <div class="hero">
      <h1>build-kg</h1>
      <p class="tagline">CLI Reference: Chunker</p>
      <div class="badges">
        <span class="badge green">build-kg-chunk</span>
        <span class="badge blue">Local Processing</span>
        <span class="badge purple">No API Key Required</span>
      </div>
    </div>

    <p>Chunk markdown and PDF files into JSON fragments using the Unstructured open-source library. Runs entirely locally with no API key required. Works for any topic &mdash; regulatory, technical, scientific, or otherwise.</p>

    <!-- Usage -->
    <section>
      <h2>Usage</h2>
      <pre><code>build-kg-chunk &lt;input_dir&gt; &lt;output_dir&gt; [OPTIONS]</code></pre>
      <p>Or via Python module:</p>
      <pre><code>python -m build_kg.chunk &lt;input_dir&gt; &lt;output_dir&gt; [OPTIONS]</code></pre>
    </section>

    <!-- Arguments -->
    <section>
      <h2>Arguments</h2>
      <table>
        <thead>
          <tr>
            <th>Argument</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>input_dir</code></td>
            <td>Directory containing input files (markdown and/or PDF). Searched recursively.</td>
          </tr>
          <tr>
            <td><code>output_dir</code></td>
            <td>Directory to save chunked JSON output files. Created if it does not exist.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Options -->
    <section>
      <h2>Options</h2>
      <table>
        <thead>
          <tr>
            <th>Flag</th>
            <th>Default</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>--strategy STRATEGY</code></td>
            <td><code>by_title</code></td>
            <td>Chunking strategy: <code>basic</code> or <code>by_title</code></td>
          </tr>
          <tr>
            <td><code>--max-chars N</code></td>
            <td><code>1000</code></td>
            <td>Maximum characters per chunk</td>
          </tr>
          <tr>
            <td><code>--overlap N</code></td>
            <td><code>0</code></td>
            <td>Number of characters to overlap between consecutive chunks</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Chunking Strategies -->
    <section>
      <h2>Chunking Strategies</h2>

      <h3><code>by_title</code> (Recommended)</h3>
      <p>Respects document structure by starting a new chunk at each heading boundary. Combines small text blocks under headings and splits large sections to stay within the character limit.</p>
      <p>Parameters used internally:</p>
      <ul>
        <li><code>max_characters</code>: Set by <code>--max-chars</code></li>
        <li><code>new_after_n_chars</code>: 80% of <code>--max-chars</code> (soft target for starting a new chunk)</li>
        <li><code>combine_text_under_n_chars</code>: 100 characters (merge very small blocks)</li>
        <li><code>overlap</code>: Set by <code>--overlap</code></li>
      </ul>
      <p>This strategy is recommended for structured documents (regulatory text, technical documentation, specifications) because it preserves section boundaries like numbered sections and headings.</p>

      <h3><code>basic</code></h3>
      <p>Fills chunks to the maximum character limit without regard for document structure. Useful when the input text has no meaningful headings or when you want uniform chunk sizes.</p>
      <p>Parameters used internally:</p>
      <ul>
        <li><code>max_characters</code>: Set by <code>--max-chars</code></li>
        <li><code>new_after_n_chars</code>: 80% of <code>--max-chars</code></li>
        <li><code>overlap</code>: Set by <code>--overlap</code></li>
      </ul>
    </section>

    <!-- Supported File Types -->
    <section>
      <h2>Supported File Types</h2>
      <table>
        <thead>
          <tr>
            <th>Extension</th>
            <th>Library</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>.md</code></td>
            <td><code>unstructured.partition.md</code></td>
            <td>Included in base install</td>
          </tr>
          <tr>
            <td><code>.pdf</code></td>
            <td><code>unstructured.partition.pdf</code></td>
            <td>Requires the <code>[pdf]</code> extra: <code>pip install build-kg[pdf]</code></td>
          </tr>
        </tbody>
      </table>

      <p>To install PDF support:</p>
      <pre><code>pip install "build-kg[pdf]"</code></pre>

      <p>PDF processing may also require system packages <code>poppler-utils</code> and <code>tesseract-ocr</code> for OCR-based extraction:</p>
      <pre><code># Ubuntu/Debian
sudo apt install poppler-utils tesseract-ocr

# macOS
brew install poppler tesseract</code></pre>
    </section>

    <!-- Output Format -->
    <section>
      <h2>Output Format</h2>
      <p>Each chunk is saved as a separate JSON file named <code>{original_filename}_chunk_{N}.json</code>.</p>

      <h3>Example Output</h3>
      <p>For an input file <code>food-labelling_depth0_20260218_143022.md</code>, the chunker produces:</p>
      <pre><code>food-labelling_depth0_20260218_143022_chunk_1.json
food-labelling_depth0_20260218_143022_chunk_2.json
food-labelling_depth0_20260218_143022_chunk_3.json
...</code></pre>

      <p>Each JSON file has this structure:</p>
      <pre><code>{
  "text": "The nutrition facts table must include the following information: energy value in calories and kilojoules, protein, total fat, saturated fat, trans fat, cholesterol, sodium, total carbohydrate, dietary fibre, sugars, and any vitamins or minerals present in significant amounts.",
  "type": "CompositeElement",
  "metadata": {
    "filename": "food-labelling_depth0_20260218_143022.md",
    "filetype": "text/markdown",
    "languages": ["eng"],
    "page_number": 1,
    "source_file_path": "/crawl_output/hc_labelling/food-labelling_depth0_20260218_143022.md",
    "chunking_date": "2026-02-18 14:35:00",
    "chunking_strategy": "by_title",
    "max_characters": 1000,
    "chunk_index": 3,
    "total_chunks": 8,
    "chunk_position": "middle",
    "fingerprint": "a1b2c3d4e5f6..."
  }
}</code></pre>

      <h3>Metadata Fields</h3>
      <table>
        <thead>
          <tr>
            <th>Field</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>filename</code></td>
            <td>Original source filename</td>
          </tr>
          <tr>
            <td><code>filetype</code></td>
            <td>MIME type of the source file</td>
          </tr>
          <tr>
            <td><code>languages</code></td>
            <td>Detected languages</td>
          </tr>
          <tr>
            <td><code>page_number</code></td>
            <td>Page number in the source document (for PDFs)</td>
          </tr>
          <tr>
            <td><code>source_file_path</code></td>
            <td>Path to the source file, including up to 2 parent directories</td>
          </tr>
          <tr>
            <td><code>chunking_date</code></td>
            <td>Timestamp when chunking was performed</td>
          </tr>
          <tr>
            <td><code>chunking_strategy</code></td>
            <td>Strategy used (<code>basic</code> or <code>by_title</code>)</td>
          </tr>
          <tr>
            <td><code>max_characters</code></td>
            <td>Maximum character limit that was configured</td>
          </tr>
          <tr>
            <td><code>chunk_index</code></td>
            <td>1-based index of this chunk within the document</td>
          </tr>
          <tr>
            <td><code>total_chunks</code></td>
            <td>Total number of chunks for this document</td>
          </tr>
          <tr>
            <td><code>chunk_position</code></td>
            <td>Position within the document: <code>first</code>, <code>middle</code>, <code>last</code>, or <code>only</code></td>
          </tr>
          <tr>
            <td><code>fingerprint</code></td>
            <td>SHA-256 hash of normalized text (for deduplication)</td>
          </tr>
          <tr>
            <td><code>coordinates</code></td>
            <td>Bounding box coordinates (PDFs only, when available)</td>
          </tr>
          <tr>
            <td><code>detection_class_prob</code></td>
            <td>Element detection confidence scores (PDFs only, when available)</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Directory Structure Preservation -->
    <section>
      <h2>Directory Structure Preservation</h2>
      <p>The chunker preserves the directory structure of the input. If the input directory looks like:</p>
      <pre><code>crawl_output/
  sfa_food_regs/
    legislation_depth0_20260218.md
    food-safety_depth1_20260218.md
  hpb_nutrition/
    food-beverage_depth0_20260218.md</code></pre>

      <p>The output directory will mirror this:</p>
      <pre><code>chunk_output/
  sfa_food_regs/
    legislation_depth0_20260218_chunk_1.json
    legislation_depth0_20260218_chunk_2.json
    food-safety_depth1_20260218_chunk_1.json
  hpb_nutrition/
    food-beverage_depth0_20260218_chunk_1.json
    food-beverage_depth0_20260218_chunk_2.json</code></pre>

      <p>This structure is important because the database loader uses the directory name to match chunks to their source entry in the crawl manifest.</p>
    </section>

    <!-- Examples -->
    <section>
      <h2>Examples</h2>

      <h3>Standard chunking for structured documents</h3>
      <pre><code>build-kg-chunk ./crawl_output/ ./chunk_output/ --strategy by_title --max-chars 1000</code></pre>

      <h3>Chunking with overlap for better context</h3>
      <pre><code>build-kg-chunk ./crawl_output/ ./chunk_output/ --strategy by_title --max-chars 1000 --overlap 100</code></pre>

      <h3>Basic chunking for unstructured text</h3>
      <pre><code>build-kg-chunk ./crawl_output/ ./chunk_output/ --strategy basic --max-chars 500</code></pre>

      <h3>Chunking PDF documents</h3>
      <pre><code>pip install "build-kg[pdf]"
build-kg-chunk ./pdf_documents/ ./chunk_output/ --strategy by_title --max-chars 1200</code></pre>
    </section>

    <!-- Choosing max-chars -->
    <section>
      <h2>Choosing max-chars</h2>
      <table>
        <thead>
          <tr>
            <th>Fragment Length</th>
            <th>Trade-off</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>500 chars</td>
            <td>More chunks, more granular, higher parsing cost</td>
          </tr>
          <tr>
            <td>1000 chars (default)</td>
            <td>Good balance for most document types</td>
          </tr>
          <tr>
            <td>1500-2000 chars</td>
            <td>Fewer chunks, cheaper parsing, but may mix multiple topics per chunk</td>
          </tr>
        </tbody>
      </table>
      <p>For most text, 1000 characters typically captures one coherent section or subsection. This is the recommended default.</p>
    </section>

    <!-- Troubleshooting -->
    <section>
      <h2>Troubleshooting</h2>
      <table>
        <thead>
          <tr>
            <th>Problem</th>
            <th>Solution</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>"No PDF or MD files found"</td>
            <td>Check that the input directory contains <code>.md</code> or <code>.pdf</code> files (the search is recursive)</td>
          </tr>
          <tr>
            <td>"PDF support not installed"</td>
            <td>Run <code>pip install "build-kg[pdf]"</code></td>
          </tr>
          <tr>
            <td>PDF chunking fails with OCR errors</td>
            <td>Install <code>poppler-utils</code> and <code>tesseract-ocr</code> system packages</td>
          </tr>
          <tr>
            <td>Very small chunks (&lt; 50 chars)</td>
            <td>These are filtered out by the database loader (min 10 chars) and parser (min 50 chars)</td>
          </tr>
          <tr>
            <td>"Unsupported file type"</td>
            <td>Only <code>.md</code> and <code>.pdf</code> are supported. Convert other formats to markdown first.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <footer>
      <p>build-kg &mdash; Apache 2.0 License &mdash; <a href="https://github.com/mergen-ai/build-kg">GitHub</a></p>
    </footer>

  </div>
</body>
</html>
