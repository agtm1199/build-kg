# build-kg v0.3.0 — Ontology Required, Regulatory Code Removed

**Date:** 2026-02-21
**License:** Apache 2.0

---

## Summary

v0.3.0 completes the transition from regulatory-specific tool to generic knowledge graph builder. The legacy regulatory code path (Provision/Requirement/Constraint) has been **fully removed** from the core pipeline. Ontology is now **required** for all parsing — there is no fallback. This release also adds a GitHub Actions CI pipeline and polished terminal-styled documentation.

The result is a smaller, cleaner codebase: **456 lines removed** across the core modules with zero functionality loss for ontology-driven workflows.

---

## Highlights

### Ontology Required (No Regulatory Fallback)

The `--ontology` flag is now **required** on `build-kg-parse`, `build-kg-parse-batch`, and `build-kg-setup`. Without an ontology, the parser will not run. This removes the ambiguity of v0.2.0 where an undocumented regulatory fallback still existed in the code.

```bash
# v0.2.0 — ontology optional, fell back to regulatory mode
build-kg-parse --limit 10

# v0.3.0 — ontology required
build-kg-parse --ontology ontology.yaml --limit 10
```

The `/build-kg` skill is unaffected — it always generates an ontology before parsing.

### Regulatory Code Removed

All regulatory-specific code has been deleted from the core pipeline:

| Removed | Module |
|---------|--------|
| `ParsedProvision` dataclass | `parse.py` |
| `parse_with_llm()` — regulatory LLM parsing | `parse.py` |
| `load_to_graph()` — Provision/Requirement/Constraint Cypher | `parse.py`, `parse_batch.py` |
| `_build_regulatory_prompt()` | `domain.py` |
| `RegulatoryParser` alias | `parse.py` |
| `ProvisionIDExtractor` import from core | `parse.py` |
| Hardcoded `RegulatorySource`/`Provision`/`Requirement`/`Constraint` labels | `setup_graph.py` |

`id_extractors.py` remains in the package as an optional utility but is no longer imported by any core module.

### GitHub Actions CI

New `.github/workflows/ci.yml` runs on every push and pull request:

- **Lint** — `ruff check src/ tests/` on Python 3.12
- **Test** — `pytest tests/ -v` on Python 3.10, 3.11, and 3.12

### Terminal-Styled Documentation

All code blocks in `docs.html` and `tutorial.html` now use styled terminal components with bash-style syntax coloring — matching the landing page design:

- **Shell commands** — green `$` prompts, white commands, orange flags, gray comments
- **CLI output** — blue phase names, green checkmarks, orange values
- **SQL/Cypher** — purple keywords, blue functions, green strings
- **YAML/JSON/Python** — language-specific syntax highlighting

---

## What's New

### CI/CD

- **`.github/workflows/ci.yml`** — lint + test pipeline on push/PR to main
- Matrix testing across Python 3.10, 3.11, 3.12

### Documentation

- **Terminal components** in `docs.html` (25 blocks) and `tutorial.html` (16 blocks)
- Syntax highlighting for YAML, SQL, Python, and JSON code blocks
- Error output blocks styled with red error text
- `.env` configuration blocks with key/value coloring

---

## What Changed

### Breaking Changes

- **`--ontology` is now required** on `build-kg-parse` and `build-kg-parse-batch`. Omitting it produces a CLI error instead of falling back to regulatory mode.
- **`RegulatoryParser` alias removed** — use `KGParser` directly.
- **`build_prompt()` requires an ontology** — calling it without one raises `ValueError`.
- **Default graph name** changed from `reg_ca` to `knowledge_graph` (affects `AGE_GRAPH_NAME` default in `config.py`).

### Removed

- `ParsedProvision` dataclass and all regulatory field definitions
- `parse_with_llm()` — the regulatory LLM parsing path
- `load_to_graph()` — Provision/Requirement/Constraint Cypher queries (both sync and batch)
- `_build_regulatory_prompt()` — the legacy prompt builder
- `RegulatoryParser` backward-compatibility alias
- `ProvisionIDExtractor` import from core pipeline
- Hardcoded `RegulatorySource`, `Provision`, `Requirement`, `Constraint` vertex labels from `setup_graph.py`
- All `reg_ca` references across documentation, examples, and config defaults

### Renamed

- `parse_generic()` → `parse_fragment()` in `parse.py`
- `load_to_graph_generic()` → `load_to_graph()` in both `parse.py` and `parse_batch.py`

### Changed

- `KGParser.__init__()` — `ontology` parameter is now required (was `Optional`)
- `BatchPreparation.__init__()` and `BatchProcessor.__init__()` — `ontology` required
- `setup_graph.py` — returns empty labels and skips schema creation when no ontology provided (so `make setup` still works before ontology exists)
- `config.py` — `AGE_GRAPH_NAME` default: `reg_ca` → `knowledge_graph`
- `domain.py` — `build_prompt()` raises `ValueError` when no ontology is available
- `llm.py` — removed unused `import json`, fixed import sorting
- `test_domain.py` — tests updated for required ontology; added `test_raises_without_ontology`
- `test_config.py` — fixed import sorting

### Files Not Modified

- `id_extractors.py` — kept as optional utility, no longer imported by core
- `load.py` — jurisdiction/authority/doc_type are generic metadata, no changes
- `crawl.py`, `chunk.py`, `verify.py` — already generic
- Domain YAML files — existing `parsing` fields silently accepted by Pydantic (backward compat)
- `SKILL.md`, `AGENTS.md` — already pass `--ontology`

---

## Migration Guide

### If you use the `/build-kg` skill (most users)

No changes needed. The skill always generates an ontology before parsing.

### If you call CLI tools directly

Add `--ontology path/to/ontology.yaml` to your `build-kg-parse` and `build-kg-parse-batch` commands:

```bash
# Before (v0.2.0)
build-kg-parse --limit 100

# After (v0.3.0)
build-kg-parse --ontology ontology.yaml --limit 100
```

### If you reference `RegulatoryParser`

Replace with `KGParser`:

```python
# Before
from build_kg.parse import RegulatoryParser

# After
from build_kg.parse import KGParser
```

### If your graph is named `reg_ca`

The default is now `knowledge_graph`. Either set `AGE_GRAPH_NAME=reg_ca` in `.env` or create a new graph.

---

## Stats

| Metric | v0.2.0 | v0.3.0 | Delta |
|--------|--------|--------|-------|
| Source lines (src/) | ~4,250 | ~3,800 | -450 |
| Test lines | ~530 | ~580 | +50 |
| Core modules changed | — | 7 | — |
| Lines removed | — | 653 | — |
| Lines added | — | 197 | — |
| Net reduction | — | **-456** | — |
| Tests passing | 71 | 71 | 0 |

---

## Links

- Repository: https://github.com/agtm1199/build-kg
- Documentation: `docs/docs.html`
- Tutorial: `docs/tutorial.html`
- License: Apache 2.0
